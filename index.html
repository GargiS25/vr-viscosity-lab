<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VR Viscosity Lab (Beginner Friendly)</title>  <!-- Three.js library -->  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>  <style>
    body{
      margin:0;
      overflow:hidden;
      font-family:Arial;
      background:#f4f6fb; /* LIGHT BACKGROUND */
    }
    #hud{
      position:absolute;
      top:10px;left:10px;
      background:rgba(20,20,20,0.85);
      color:#fff;
      padding:12px;
      border-radius:6px;
      max-width:520px;
      max-height:320px;
      overflow:auto;
    }
    #controls{
      position:absolute;
      bottom:10px;left:10px;
      background:#ffffff;
      color:#111;
      padding:12px;
      border-radius:6px;
      max-width:560px;
    }
    .row{display:flex;gap:10px;margin:6px 0;align-items:center}
    label{min-width:160px;font-weight:bold}
    select,input{flex:1;padding:6px}
    button{padding:8px 10px;border-radius:4px;border:1px solid #ccc;cursor:pointer}
    .reset{background:#d9534f;color:#fff;border:none}
    .clear{background:#f0ad4e;color:#fff;border:none}
    .export{background:#5cb85c;color:#fff;border:none}
    #chartCanvas{
      position:absolute;
      right:20px;bottom:20px; /* moved slightly away */
      background:#ffffff;
      padding:10px;
      border-radius:6px;
    }
  </style></head>
<body><div id="hud">Results will appear here...</div><div id="controls">
  <div class="row">
    <label>Liquid</label>
    <select id="liquid">
      <option>water</option><option>glycerol</option><option>honey</option>
      <option>oil</option><option>ethanol</option><option>milk</option>
      <option>blood</option><option>oliveoil</option>
    </select>
  </div>
  <div class="row"><label>Sphere radius (mm)</label><input id="radius" type="number" value="5"></div>
  <div class="row"><label>Sphere density (kg/m³)</label><input id="density" type="number" value="7800"></div>
  <div class="row"><label>Temperature (°C)</label><input id="temperature" type="number" value="25"></div>
  <div class="row">
    <button id="simulate">Simulate</button>
    <button id="compare">Compare</button>
    <button id="reset" class="reset">Reset</button>
    <button id="clear" class="clear">Clear</button>
    <button id="export" class="export">Export</button>
  </div>
</div><canvas id="chartCanvas" width="420" height="220"></canvas>

<script>
const $ = id => document.getElementById(id);
const hud = $("hud");
const ctx = $("chartCanvas").getContext("2d");

const liquids = {
  water:{d:997,v:0.89}, glycerol:{d:1260,v:1410}, honey:{d:1420,v:10000},
  oil:{d:880,v:250}, ethanol:{d:789,v:1.2}, milk:{d:1030,v:2},
  blood:{d:1060,v:3.5}, oliveoil:{d:910,v:84}
};

const colors = {
  water:0x4aa3ff, glycerol:0x8b5cf6, honey:0xf59e0b, oil:0x10b981,
  ethanol:0xec4899, milk:0x93c5fd, blood:0xef4444, oliveoil:0x84cc16
};

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf4f6fb); // LIGHT SCENE

const camera = new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,100);
camera.position.set(0,2,6);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.PointLight(0xffffff,1).position.set(5,5,5));
scene.add(new THREE.AmbientLight(0x888888));

// DARK BEAKER
const tube = new THREE.Mesh(
  new THREE.CylinderGeometry(0.5,0.5,4,32,1,true),
  new THREE.MeshPhongMaterial({
    color:0x222222,
    transparent:true,
    opacity:0.35,
    side:THREE.DoubleSide
  })
);
scene.add(tube);

const sphere = new THREE.Mesh(
  new THREE.SphereGeometry(0.1,32,32),
  new THREE.MeshPhongMaterial({color:0xff5722})
);
sphere.position.y=2;
scene.add(sphere);

let vt=0, running=false, log=[];

function simulate(){
  sphere.position.y=2; running=true;
  const r=$("radius").value/1000, rs=$("density").value;
  const T=$("temperature").value, name=$("liquid").value;
  const L=liquids[name];

  sphere.material.color.setHex(colors[name]);

  const mu=L.v/1000*Math.pow(0.98,T-25);
  vt=(2/9)*(rs-L.d)*9.81*r*r/mu;
  const Re=L.d*vt*2*r/mu;

  log.push({l:name,t:T,v:mu*1000,vt,Re});
  hud.innerHTML=`<b>${name}</b><br>Viscosity: ${(mu*1000).toFixed(2)} mPa·s<br>Terminal velocity: ${vt.toFixed(3)} m/s<br>Reynolds: ${Re.toFixed(2)} ${Re<1?'✓':'⚠'}`;
  draw();
}

function compare(){
  if(!log.length){hud.textContent='Run simulations first.';return}
  hud.innerHTML='<table><tr><th>Liquid</th><th>μ</th><th>vₜ</th><th>Re</th></tr>'+
    log.map(r=>`<tr><td>${r.l}</td><td>${r.v.toFixed(2)}</td><td>${r.vt.toFixed(3)}</td><td>${r.Re.toFixed(2)}</td></tr>`).join('')+'</table>';
  draw();
}

function draw(){
  ctx.clearRect(0,0,420,220);
  if(!log.length)return;
  ctx.fillText('Viscosity (mPa·s)',10,14);
  const max=Math.max(...log.map(r=>r.v));
  log.forEach((r,i)=>{
    const h=(r.v/max)*160;
    ctx.fillStyle='#4aa3ff';
    ctx.fillRect(40+i*45,200-h,28,h);
    ctx.fillStyle='#000';
    ctx.fillText(r.l,40+i*45,215);
  });
}

function exportCSV(){
  if(!log.length){hud.textContent='Nothing to export';return}
  const csv=['liquid,temp,viscosity,vt,Re',...log.map(r=>[r.l,r.t,r.v,r.vt,r.Re].join(','))].join('\n');
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download='viscosity.csv'; a.click();
}

$("simulate").onclick=simulate;
$("compare").onclick=compare;
$("reset").onclick=()=>{running=false;sphere.position.y=2;hud.textContent='Reset'};
$("clear").onclick=()=>{log=[];ctx.clearRect(0,0,420,220);hud.textContent='Cleared'};
$("export").onclick=exportCSV;

(function animate(){
  requestAnimationFrame(animate);
  if(running&&sphere.position.y>-2)sphere.position.y-=vt*0.01;
  renderer.render(scene,camera);
})();

onresize=()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)};
</script></body>
</html>
